#!/usr/bin/env rundklet
add_note <<~Note
  Demo test nginx-proxy
Note

register_net

write_specfile <<~Desc
  version: '2'
  services:
    whoami:
      image: jwilder/whoami
      environment:
        - VIRTUAL_HOST=whoami.lh
  networks:
    default:
      external:
        name: #{netname}
Desc

task :main do
  invoke :netup, [], {}
  system <<~Desc
    #{compose_cmd} up -d
  Desc
end

before_task :clean do
  system <<~Desc
    #{compose_cmd} down
  Desc
end
