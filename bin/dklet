#!/usr/bin/env rundklet
add_note <<~Note
  Base dklet settings and commands
Note

register_net
register :appname, 'docklet'

write_dockerfile <<~Desc
  FROM alpine:3.7
  LABEL <%=image_labels%>
Desc

task :main, preclean: false do
  puts "Welcome to dklet"
  invoke :help
end

custom_commands do
  desc 'init', 'init dklet'
  def init
    invoke :netup, [], {}

    system <<~Desc
      # ensure global volumes root exists
      sudo mkdir -p #{volumes_root}
      mkdir -p #{dklet_tmp_path}
    Desc

    puts "dklet ready to fly with you!"
  end

  desc 'host_domain', ''
  def host_domain
    puts host_domain_in_container
  end

  desc '', ''
  def clear
    system <<~Desc
    Desc
  end

  desc '', ''
  def stat
    system <<~Desc
      echo ==files total count:
      git ls-files | wc -l
      echo ==lib lines:
      wc -l lib/docker_kit.rb
      echo ==containers
      docker ps -f label=dklet_env=#{env}
      echo ==images
      docker images -f label=dklet_env=#{env}
    Desc
  end
end
