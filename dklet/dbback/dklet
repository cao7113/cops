#!/usr/bin/env rundklet

# ref https://docs.docker.com/engine/reference/builder/#usage
set_dockerfile <<~Desc
  FROM alpine:3.7
  LABEL maintainer=dailyops
  COPY backup-db.sh /backup-db.sh
  ENTRYPOINT ["/backup-db.sh"]
  # as volume
  WORKDIR /dbs
  CMD sh
Desc

task :main do
  system <<~Desc
    docker run --rm #{docker_image} postgres://a.b.c/db1
  Desc
end

custom_commands do
  def build
    system <<~Desc
      docker build --tag #{docker_image} --file #{dockerfile} #{script_path}
    Desc
  end
end

add_note <<~Note
  demo db backup
  https://medium.freecodecamp.org/docker-entrypoint-cmd-dockerfile-best-practices-abc591c30e21
Note

let_cli_magic_start! # make dockerize fun with ruby 
